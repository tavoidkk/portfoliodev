---
import * as Icons from './icons/index.js';
import { projects } from './projects.js';

const TAG_ICONS: Record<string, any> = {
    'NextJS': Icons.NextJSIcon,
    'Astro': Icons.AstroIcon,
    'GitHub': Icons.GitHubIcon,
    'Python': Icons.PythonIcon,
    'JavaScript': Icons.JavaScriptIcon,
    'React': Icons.ReactIcon,
    'NodeJS': Icons.NodeJSIcon,
    'ExpressJS': Icons.ExpressJSIcon,
    'MySQL': Icons.MySQLIcon
};
---
<section class="project-animate opacity-0 translate-y-8 transition-all duration-700 grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6 lg:gap-8">
    {projects.map(project => (
        <article class="relative w-full bg-white border border-gray-200 rounded-lg transition-transform duration-800 transform hover:scale-105 hover:border-purple-900 dark:bg-gray-800 dark:border-gray-700 dark:hover:border-purple-500 group shadow-white/7 shadow-2xl">
            <figure class="relative">
                <a href={project.href} target="_blank" rel="noopener noreferrer">
                    <img class="rounded-t-lg w-full h-40 md:h-32 object-cover" src={project.image} alt={project.title} />
                </a>
                <figcaption class="absolute bottom-2 right-2 flex space-x-1 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                    {project.tags.map((tag, i) => {
                        const Icon = TAG_ICONS[tag] || null;
                        return Icon ? (
                            <Icon
                                class={`rounded min-w-[24px] min-h-[24px] max-w-[32px] max-h-[32px] w-5 h-5 transition-all duration-500
                                    group-hover:translate-y-0 translate-y-[-24px]
                                    group-hover:opacity-100 opacity-0
                                `}
                                style={`transition-delay: ${i * 120}ms;`}
                            />
                        ) : null;
                    })}
                </figcaption>
            </figure>
            <section class="p-4 flex flex-col justify-between min-h-[180px]">
                <header>
                    <h2 class="mb-1 text-base md:text-lg font-bold tracking-tight text-yellow-400">{project.title}</h2>
                </header>
                <p class="mb-3 text-xs md:text-sm font-normal text-gray-700 group-hover:text-gray-300 dark:text-gray-400">{project.description}</p>
                <footer class="flex flex-row items-center gap-4 mt-4 md:mt-6 mb-2">
                    {project.preview && (
                    <a href={project.preview} target="_blank" rel="noopener noreferrer" class="text-gray-500 hover:text-purple-400 group-hover:text-white transition-colors duration-300" aria-label="Ver proyecto">
                        <Icons.EyeIcon />
                    </a>)}
                    <a href={project.href} target="_blank" rel="noopener noreferrer" class="text-gray-500 hover:text-yellow-400 group-hover:text-white transition-colors duration-300" aria-label="Ver repositorio en GitHub">
                        <Icons.GitHubIcon class="w-5 h-5" />
                    </a>
                </footer>
            </section>
        </article>
    ))}
</section>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.remove('opacity-0', 'translate-y-8');
        entry.target.classList.add('opacity-100', 'translate-y-0');
        observer.unobserve(entry.target);
      }
    });
  }, { threshold: 0.2 });

  document.querySelectorAll('.project-animate').forEach(el => observer.observe(el));
});
</script>

<style>
@keyframes fade-in-up {
    from {
        opacity: 0;
        transform: translateY(40px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}
.animate-fade-in-up {
    animation: fade-in-up 1s cubic-bezier(.39,.575,.565,1) both;
}
.delay-200 {
    animation-delay: .2s;
}
</style>